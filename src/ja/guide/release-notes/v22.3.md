# ãƒãƒ¼ã‚¸ãƒ§ãƒ³22.3

[[toc]]

## æ¦‚è¦

ã“ã®ãƒªãƒªãƒ¼ã‚¹ã¯ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³22ã®[ãƒªãƒªãƒ¼ã‚¹ã‚µã‚¤ã‚¯ãƒ«](../../org/policies.md#release-schedule)ã®æœ€åˆã®ãƒªãƒªãƒ¼ã‚¹ã¨ãªã‚Šã¾ã™ã€‚ ã™ã¹ã¦ã®æ¨™æº–SCOãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒåŒã˜ãƒªãƒªãƒ¼ã‚¹ã‚µã‚¤ã‚¯ãƒ«ã«å…¥ã‚Šã€åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã„ã¾ã™ã€‚ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™:

- [`sanic-routing`](https://github.com/sanic-org/sanic-routing)
- [`sanic-testing`](https://github.com/sanic-org/sanic-testing)
- [`sanic-ext`](https://github.com/sanic-org/sanic-ext)

## çŸ¥ã£ã¦ãŠããŸã„ã“ã¨

è©³ã—ãã¯[å¤‰æ›´å±¥æ­´](https://sanic.readthedocs.io/en/stable/sanic/changelog.html)ã‚’ã”è¦§ãã ã•ã„ã€‚ æ³¨ç›®ã™ã¹ãæ–°æ©Ÿèƒ½ãƒ»ä¸å…·åˆã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¯¾è±¡ãªã©...

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ«ãƒã‚µãƒ¼ãƒ“ã‚¹

Sanicã‚µãƒ¼ãƒãƒ¼ã«ã¯ã€åŒã˜ãƒ—ãƒ­ã‚»ã‚¹ã§è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸¦è¡Œã—ã¦å®Ÿè¡Œã§ãã‚‹APIãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ ã“ã‚Œã¯ã€1ã¤ã¾ãŸã¯è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã« `app.prepare(...)` ã‚’å‘¼ã³å‡ºã™ã“ã¨ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã¾ã™ã€‚ æ¯å›ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ›ã‚¹ãƒˆ/ãƒãƒ¼ãƒˆã®çµ„ã¿åˆã‚ã›ã«ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ ãã—ã¦ã€ `Sanic.serve()` ã‚’å‘¼ã³å‡ºã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¿œç­”ã—ã¾ã™ã€‚

```python
app = Sanic("One")
app2 = Sanic("Two")

app.prepare(port=9999)
app.prepare(port=9998)
app.prepare(port=9997)
app2.prepare(port=8888)
app2.prepare(port=8887)

Sanic.serve()
```

ä¸Šè¨˜ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã«ã¯ã€åŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã€è¤‡æ•°ã®ãƒãƒ¼ãƒˆã«ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã‚‹2ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚ ã“ã®æ©Ÿèƒ½ã¯ CLIã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦*ã„ã¾ã›ã‚“*ã€‚

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ `app.run(...)` ã‚’å®Ÿè¡Œã™ã‚‹ä»£ã‚ã‚Šã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ `app.run` ã¯ä¸Šè¨˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®çœç•¥å½¢ã§ã‚ã‚Šã€ã¾ã å®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

### ğŸ‘¶ *ãƒ™ãƒ¼ã‚¿æ©Ÿèƒ½* - æ–°ã—ã„ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³

A very common pattern is to create a route that dynamically generates a file. The endpoint is meant to match on a file with an extension. There is a new path parameter to match files: `<foo:ext>`.

```python
@app.get("/path/to/<filename:ext>")
async def handler(request, filename, ext):
    ...
```

This will catch any pattern that ends with a file extension. You may, however want to expand this by specifying which extensions, and also by using other path parameter types for the file name.

For example, if you want to catch a `.jpg` file that is only numbers:

```python
@app.get("/path/to/<filename=int:ext=jpg>")
async def handler(request, filename, ext):
    ...
```

Some potential examples:

<table spaces-before="0">
  <tr>
    <th>
      definition
    </th>
    
    <th>
      example
    </th>
    
    <th>
      filename
    </th>
    
    <th>
      extension
    </th>
  </tr>
  
  <tr>
    <td>
      \<file:ext>
    </td>
    
    <td>
      page.txt
    </td>
    
    <td>
      <code>"page"</code>
    </td>
    
    <td>
      <code>"txt"</code>
    </td>
  </tr>
  
  <tr>
    <td>
      \<file:ext=jpg>
    </td>
    
    <td>
      cat.jpg
    </td>
    
    <td>
      <code>"cat"</code>
    </td>
    
    <td>
      <code>"jpg"</code>
    </td>
  </tr>
  
  <tr>
    <td>
      \<file:ext=jpg\
    </td>
    
    <td>
      png\
    </td>
    
    <td>
      gif\
    </td>
    
    <td>
      svg>     | cat.jpg     | <code>"cat"</code>     | <code>"jpg"</code>
    </td>
  </tr>
  
  <tr>
    <td>
      <file=int:ext>
    </td>
    
    <td>
      123.txt
    </td>
    
    <td>
      <code>123</code>
    </td>
    
    <td>
      <code>"txt"</code>
    </td>
  </tr>
  
  <tr>
    <td>
      <file=int:ext=jpg\
    </td>
    
    <td>
      png\
    </td>
    
    <td>
      gif\
    </td>
    
    <td>
      svg> | 123.svg     | <code>123</code>       | <code>"svg"</code>
    </td>
  </tr>
  
  <tr>
    <td>
      <file=float:ext=tar.gz>
    </td>
    
    <td>
      3.14.tar.gz
    </td>
    
    <td>
      <code>3.14</code>
    </td>
    
    <td>
      <code>"tar.gz"</code>
    </td>
  </tr>
</table>

### ğŸš¨ *BREAKING CHANGE* - Path parameter matching of non-empty strings

A dynamic path parameter will only match on a non-empty string.

Previously a route with a dynamic string parameter (`/<foo>` or `/<foo:str>`) would match on any string, including empty strings. It will now only match a non-empty string. To retain the old behavior, you should use the new parameter type: `/<foo:strorempty>`.

```python
@app.get("/path/to/<foo:strorempty>")
async def handler(request, foo)
    ...
```

### ğŸš¨ *BREAKING CHANGE* - `sanic.worker.GunicornWorker` has been removed

Departing from our normal deprecation policy, the `GunicornWorker` was removed as a part of the process of upgrading the Sanic server to include multi-serve. This decision was made largely in part because even while it existed it was not an optimal strategy for deploying Sanic.

If you want to deploy Sanic using `gunicorn`, then you are advised to do it using [the strategy implemented by `uvicorn`](https://www.uvicorn.org/#running-with-gunicorn). This will effectively run Sanic as an ASGI application through `uvicorn`. You can upgrade to this pattern by installing `uvicorn`:

```
pip install uvicorn
```

Then, you should be able to run it with a pattern like this:

```
gunicorn path.to.sanic:app -k uvicorn.workers.UvicornWorker
```

### Authorization header parsing

The `Authorization` header has been partially parseable for some time now. You have been able to use `request.token` to gain access to a header that was in one of the following two forms:

```
Authorization: Token <SOME TOKEN HERE>
Authorization: Bearer <SOME TOKEN HERE>
```

Sanic can now parse more credential types like `BASIC`:

```
Authorization: Basic Z2lsLWJhdGVzOnBhc3N3b3JkMTIz
```

This can be accessed now as `request.credentials`:

```python
print(request.credentials)
# Credentials(auth_type='Basic', token='Z2lsLWJhdGVzOnBhc3N3b3JkMTIz', _username='gil-bates', _password='password123')
```

### CLI arguments optionally injected into application factory

Sanic will now attempt to inject the parsed CLI arguments into your factory if you are using one.

```python
def create_app(args):
    app = Sanic("MyApp")
    print(args)
    return app
```
```
$sanic p:create_app --factory
Namespace(module='p:create_app', factory=True, simple=False, host='127.0.0.1', port=8000, unix='', cert=None, key=None, tls=None, tlshost=False, workers=1, fast=False, access_log=False, debug=False, auto_reload=False, path=None, dev=False, motd=True, verbosity=None, noisy_exceptions=False)
```

If you are running the CLI with `--factory`, you also have the option of passing arbitrary arguments to the command, which will be injected into the argument `Namespace`.

```
sanic p:create_app --factory --foo=bar
Namespace(module='p:create_app', factory=True, simple=False, host='127.0.0.1', port=8000, unix='', cert=None, key=None, tls=None, tlshost=False, workers=1, fast=False, access_log=False, debug=False, auto_reload=False, path=None, dev=False, motd=True, verbosity=None, noisy_exceptions=False, foo='bar')
```

### New reloader process listener events

When running Sanic server with auto-reload, there are two new events that trigger a listener *only* on the reloader process:

- `reload_process_start`
- `reload_process_stop`

These are only triggered if the reloader is running.

```python
@app.reload_process_start
async def reload_start(*_):
    print(">>>>>> reload_start <<<<<<")


@app.reload_process_stop
async def reload_stop(*_):
    print(">>>>>> reload_stop <<<<<<")
```

### The event loop is no longer a required argument of a listener

You can leave out the `loop` argument of a listener. Both of these examples work as expected:

```python
@app.before_server_start
async def without(app):
    ...

@app.before_server_start
async def with(app, loop):
    ...
```

### Removal - Debug mode does not automatically start the reloader

When running with `--debug` or `debug=True`, the Sanic server will not automatically start the auto-reloader. This feature of doing both on debug was deprecated in v21 and removed in this release. If you would like to have *both* debug mode and auto-reload, you can use `--dev` or `dev=True`.

**dev = debug mode + auto reloader**

### Deprecation - Loading of lower case environment variables

Sanic loads prefixed environment variables as configuration values. It has not distinguished between uppercase and lowercase as long as the prefix matches. However, it has always been the convention that the keys should be uppercase. This is deprecated and you will receive a warning if the value is not uppercase. In v22.9 only uppercase and prefixed keys will be loaded.

## News

### Packt publishes new book on Sanic web development

---:1 There is a new book on **Python Web Development with Sanic** by [@ahopkins](https://github.com/ahopkins). The book is endorsed by the SCO and part of the proceeds of all sales go directly to the SCO for further development of Sanic.

You can learn more at [sanicbook.com](https://sanicbook.com/) :--:1 ![Python Web Development with Sanic](https://sanicbook.com/images/SanicCoverFinal.png) :---

## Thank you

Thank you to everyone that participated in this release: :clap:

[@aericson](https://github.com/aericson) [@ahankinson](https://github.com/ahankinson) [@ahopkins](https://github.com/ahopkins) [@ariebovenberg](https://github.com/ariebovenberg) [@ashleysommer](https://github.com/ashleysommer) [@Bluenix2](https://github.com/Bluenix2) [@ChihweiLHBird](https://github.com/ChihweiLHBird) [@dotlambda](https://github.com/dotlambda) [@eric-spitler](https://github.com/eric-spitler) [@howzitcdf](https://github.com/howzitcdf) [@jonra1993](https://github.com/jonra1993) [@prryplatypus](https://github.com/prryplatypus) [@raphaelauv](https://github.com/raphaelauv) [@SaidBySolo](https://github.com/SaidBySolo) [@SerGeRybakov](https://github.com/SerGeRybakov) [@Tronic](https://github.com/Tronic)


---

If you enjoy the project, please consider contributing. Of course we love code contributions, but we also love contributions in any form. Consider writing some documentation, showing off use cases, joining conversations and making your voice known, and if you are able: [financial contributions](https://opencollective.com/sanic-org/).
